""" A simple port scanner that scans all TCP ports on a given host."""


import socket
import sys
import pyfiglet


ascii_banner = pyfiglet.figlet_format("Port Scanner")
print(ascii_banner)

# Ask the user for the IP or hostname to scan
host_input = input("Enter IP address or hostname to scan (e.g. 10.10.10.10 or example.com): ").strip()
if not host_input:
    print("No host provided. Exiting.")
    sys.exit(1)

# Resolve hostname to IP if needed
try:
    ip = socket.gethostbyname(host_input)
except socket.gaierror:
    print(f"Could not resolve host: {host_input}")
    sys.exit(1)

print(f"Scanning host: {host_input} (resolved to {ip})")


open_ports = []  # store open ports
ports = range(1, 65535)  # 1..65534 (same as original)


def probe_port(ip, port, result=1):
    try:
        # IPv4 TCP socket
        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        sock.settimeout(0.5)
        r = sock.connect_ex((ip, port))
        if r == 0:
            result = r
        sock.close()
    except Exception:
        # ignore connection errors / timeouts
        pass
    return result


try:
    for port in ports:
        # optional: show progress (uncomment if desired)
        # print(f"Probing {port}", end="\r")
        sys.stdout.flush()
        response = probe_port(ip, port)
        if response == 0:
            open_ports.append(port)
except KeyboardInterrupt:
    print("\nScan interrupted by user.")


if open_ports:
    print("Open ports are:")
    print(sorted(open_ports))
else:
    print("Looks like the ports are not open.")
