#!/usr/bin/env python3
import random
import string

# Basic phonetic building blocks
CONSONANTS = [
    "b","c","d","f","g","h","j","k","l","m","n","p","r","s","t","v","w","z",
    "bl","br","cl","cr","dr","fl","fr","gl","gr","pl","pr","tr","st","sp","sk"
]
VOWELS = ["a","e","i","o","u","ae","io","ou","ai","ea"]

NUMBER_MAP = {'a': '4', 'e': '3', 'i': '1', 'o': '0', 's': '5', 't': '7'}
SPECIALS = "!@#$%^&*?"

def gen_syllable():
    """Generate a pronounceable syllable."""
    part = ""
    if random.random() < 0.9:
        part += random.choice(CONSONANTS)
    part += random.choice(VOWELS)
    if random.random() < 0.6:
        part += random.choice([c for c in CONSONANTS if len(c) == 1])
    return part

def gen_word(min_syll=2, max_syll=3):
    """Build a pseudo-word from syllables."""
    syll_count = random.randint(min_syll, max_syll)
    word = "".join(gen_syllable() for _ in range(syll_count))
    if random.random() < 0.5:
        word = word.capitalize()
    return word

def apply_substitutions(password, num_replacements=2, special_replacements=1):
    """Apply exactly two numeric substitutions and one special-character substitution."""
    pw = list(password)

    eligible_num_indices = [i for i, ch in enumerate(pw) if ch.lower() in NUMBER_MAP]
    if len(eligible_num_indices) < num_replacements:
        extra = [i for i, ch in enumerate(pw) if ch.isalpha() and i not in eligible_num_indices]
        eligible_num_indices += extra
    if len(eligible_num_indices) < num_replacements:
        all_idx = [i for i in range(len(pw)) if i not in eligible_num_indices]
        eligible_num_indices += all_idx

    num_indices = random.sample(eligible_num_indices, k=min(num_replacements, len(eligible_num_indices)))
    for i in num_indices:
        ch = pw[i]
        pw[i] = NUMBER_MAP.get(ch.lower(), random.choice(string.digits))

    eligible_spec_indices = [i for i, ch in enumerate(pw) if ch.isalpha()]
    if not eligible_spec_indices:
        pos = random.randint(0, len(pw))
        pw.insert(pos, random.choice(SPECIALS))
    else:
        idx = random.choice(eligible_spec_indices)
        pw[idx] = random.choice(SPECIALS)

    return "".join(pw)

def generate_password(num_words, separator):
    """Generate one password candidate."""
    words = [gen_word() for _ in range(num_words)]
    base = separator.join(words)
    return apply_substitutions(base)

def password_generator():
    # Ask for number of words
    while True:
        try:
            num_words = int(input("How many words would you like? (2, 3, or 4): ").strip())
            if num_words in (2, 3, 4):
                break
            print("Please enter 2, 3, or 4.")
        except ValueError:
            print("Invalid input. Enter 2, 3, or 4.")

    # Ask for separator
    while True:
        sep = input("Choose separator ('-' or '_'): ").strip()
        if sep in ('-', '_'):
            break
        print("Please choose '-' or '_'.")

    # Generate until length requirement met (16â€“20 chars)
    for _ in range(1000):  # just in case
        candidate = generate_password(num_words, sep)
        if 16 <= len(candidate) <= 20:
            print(f"\nGenerated professional password ({len(candidate)} chars):")
            print(candidate)
            return candidate

    print("Failed to generate a password within length constraints. Try again.")

if __name__ == "__main__":
    password_generator()
